#!/bin/bash
# Post-commit hook to check version bump on main/release branches

BRANCH_NAME=$(git symbolic-ref --short HEAD 2>/dev/null)

# Only check on important branches
if [[ ! $BRANCH_NAME =~ ^(main|master|release/) ]]; then
    exit 0
fi

echo ""
echo "⚠️  You committed to $BRANCH_NAME"

# Check if version files were modified
if git diff HEAD~1 HEAD --name-only | grep -qE 'build.gradle(\.kts)?$'; then
    echo "✅ Build file was modified (version might be updated)"
else
    echo "❌ WARNING: Build file was NOT modified"
    echo "   Did you remember to bump versionCode and versionName?"
    echo ""
    echo "   Current version info:"

    if [ -f "app/build.gradle.kts" ]; then
        grep -E 'versionCode|versionName' app/build.gradle.kts | head -2
    elif [ -f "app/build.gradle" ]; then
        grep -E 'versionCode|versionName' app/build.gradle | head -2
    fi
    echo ""
fi

exit 0
